<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Memory Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #89f7fe, #66a6ff);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        overflow-x: hidden;
      }
      #navbar {
        width: 100%;
        background: #2196f3;
        color: white;
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 10px 0;
        flex-wrap: wrap;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      #navbar input,
      #navbar select,
      #navbar button {
        padding: 5px;
        border-radius: 5px;
        border: none;
        font-size: 14px;
      }
      #navbar div {
        margin: 5px;
        font-size: 16px;
      }

      #board {
        display: grid;
        gap: 10px;
        justify-content: center;
        margin: 20px auto;
        max-width: 100%;
      }
      .card {
        width: 70px;
        height: 70px;
        background: #4caf50;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        color: transparent;
        border-radius: 10px;
        transition: transform 0.5s, background 0.3s, color 0.3s, box-shadow 0.3s;
        transform-style: preserve-3d;
        user-select: none;
        perspective: 600px;
      }
      .card.flipped {
        background: #fff;
        color: #000;
        transform: rotateY(180deg) scale(1.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      .card.matched {
        background: #ff9800;
        color: #fff;
        transform: rotateY(180deg) scale(1.1);
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.8);
        animation: sparkle 0.6s ease-in-out;
      }
      .card.matched:hover {
        animation: bounce 0.5s;
        box-shadow: 0 10px 25px rgba(255, 255, 0, 1);
      }
      @keyframes sparkle {
        0% {
          transform: scale(1) rotateY(180deg);
        }
        50% {
          transform: scale(1.3) rotateY(180deg);
          box-shadow: 0 8px 25px rgba(255, 255, 0, 0.9);
        }
        100% {
          transform: scale(1.1) rotateY(180deg);
        }
      }
      @keyframes bounce {
        0%,
        100% {
          transform: rotateY(180deg) scale(1.1);
        }
        50% {
          transform: rotateY(180deg) scale(1.3) translateY(-10px);
        }
      }
      @media (max-width: 400px) {
        .card {
          width: 60px;
          height: 60px;
          font-size: 20px;
        }
      }
      canvas {
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <div id="navbar">
      <div>
        Player: <input type="text" id="player-name" placeholder="Your name" />
      </div>
      <div>
        Level:
        <select id="level">
          <option value="easy">Easy (8 Pairs)</option>
          <option value="medium">Medium (12 Pairs)</option>
          <option value="hard">Hard (16 Pairs)</option>
        </select>
      </div>
      <div>
        Theme:
        <select id="theme">
          <option value="fruits">Fruits</option>
          <option value="animals">Animals</option>
          <option value="emoji">Emoji</option>
        </select>
      </div>
      <div id="moves">Moves: 0</div>
      <div id="score">Score: 0</div>
      <div id="timer">Time: 0s</div>
      <button id="restart">Restart</button>
    </div>

    <div id="board"></div>

    <!-- Sounds -->
    <audio
      id="win-sound"
      src="https://freesound.org/data/previews/341/341695_6268366-lq.mp3"
    ></audio>
    <audio
      id="match-sound"
      src="https://freesound.org/data/previews/341/341692_6268366-lq.mp3"
    ></audio>
    <audio
      id="flip-sound"
      src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3"
    ></audio>

    <canvas id="confetti"></canvas>

    <script>
      const board = document.getElementById("board");
      const movesEl = document.getElementById("moves");
      const scoreEl = document.getElementById("score");
      const timerEl = document.getElementById("timer");
      const levelSelect = document.getElementById("level");
      const themeSelect = document.getElementById("theme");
      const restartBtn = document.getElementById("restart");
      const winSound = document.getElementById("win-sound");
      const matchSound = document.getElementById("match-sound");
      const flipSound = document.getElementById("flip-sound");
      const confettiCanvas = document.getElementById("confetti");
      const ctx = confettiCanvas.getContext("2d");

      let cards = [],
        firstCard,
        secondCard;
      let lockBoard = false,
        matchedPairs = 0;
      let moves = 0,
        score = 0,
        time = 0,
        timerInterval = null;
      let gameStarted = false;
      let soundUnlocked = false;

      const symbolPool = {
        fruits: [
          "🍎",
          "🍌",
          "🍇",
          "🍊",
          "🍉",
          "🍓",
          "🍍",
          "🥭",
          "🥝",
          "🍒",
          "🍐",
          "🥥",
          "🍑",
          "🍋",
          "🫐",
          "🍈",
        ],
        animals: [
          "🐶",
          "🐱",
          "🐭",
          "🐹",
          "🐰",
          "🦊",
          "🐻",
          "🐼",
          "🐨",
          "🐯",
          "🦁",
          "🐮",
          "🐷",
          "🐸",
          "🐵",
          "🐔",
        ],
        emoji: [
          "😀",
          "😂",
          "😍",
          "😎",
          "😭",
          "😡",
          "🥶",
          "🤯",
          "😴",
          "🥳",
          "🤩",
          "😇",
          "😈",
          "🤖",
          "👻",
          "💩",
        ],
      };
      const levelPairs = { easy: 8, medium: 12, hard: 16 };

      // ---- Unlock sound on first user interaction ----
      document.body.addEventListener("click", function unlockSound() {
        if (!soundUnlocked) {
          [winSound, matchSound, flipSound].forEach((s) => {
            s.play().catch(() => {});
            s.pause();
            s.currentTime = 0;
          });
          soundUnlocked = true;
          document.body.removeEventListener("click", unlockSound);
        }
      });

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
      function generateCards(level, theme) {
        let pairs = levelPairs[level];
        let chosen = symbolPool[theme].slice(0, pairs);
        return shuffle([...chosen, ...chosen]);
      }
      function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
          time++;
          timerEl.textContent = "Time: " + time + "s";
          updateScore();
        }, 1000);
      }
      function createBoard() {
        const level = levelSelect.value;
        const theme = themeSelect.value;
        cards = generateCards(level, theme);
        matchedPairs = 0;
        moves = 0;
        score = 0;
        time = 0;
        movesEl.textContent = "Moves: 0";
        scoreEl.textContent = "Score: 0";
        timerEl.textContent = "Time: 0s";
        lockBoard = false;
        firstCard = null;
        secondCard = null;
        clearInterval(timerInterval);
        gameStarted = false;

        let cols = levelPairs[level] <= 8 ? 4 : levelPairs[level] <= 12 ? 6 : 8;
        board.style.gridTemplateColumns = `repeat(${cols}, minmax(60px,1fr))`;
        board.innerHTML = "";

        cards.forEach((symbol) => {
          const card = document.createElement("div");
          card.classList.add("card");
          card.dataset.symbol = symbol;
          card.textContent = "";
          card.addEventListener("click", flipCard);
          board.appendChild(card);
        });
      }

      function flipCard() {
        if (!gameStarted) {
          startTimer();
          gameStarted = true;
        }
        if (lockBoard || this === firstCard) return;
        this.classList.add("flipped");
        this.textContent = this.dataset.symbol;
        flipSound.play();
        if (!firstCard) {
          firstCard = this;
          return;
        }
        secondCard = this;
        moves++;
        movesEl.textContent = "Moves: " + moves;
        updateScore();
        checkMatch();
      }

      function checkMatch() {
        if (firstCard.dataset.symbol === secondCard.dataset.symbol) {
          firstCard.classList.add("matched");
          secondCard.classList.add("matched");
          matchSound.play();
          matchedPairs++;
          resetBoard();
          if (matchedPairs === levelPairs[levelSelect.value]) {
            clearInterval(timerInterval);
            winSound.play();
            startConfetti();
            setTimeout(() => {
              stopConfetti();
              alert(
                `🎉 Congratulations! ${levelSelect.value.toUpperCase()} level completed!`
              );
            }, 2500);
          }
        } else {
          lockBoard = true;
          setTimeout(() => {
            firstCard.classList.remove("flipped");
            secondCard.classList.remove("flipped");
            firstCard.textContent = "";
            secondCard.textContent = "";
            resetBoard();
          }, 1000);
        }
      }

      function resetBoard() {
        [firstCard, secondCard] = [null, null];
        lockBoard = false;
      }
      function updateScore() {
        score = Math.max(0, matchedPairs * 100 - moves * 5 - time * 2);
        scoreEl.textContent = "Score: " + score;
      }

      levelSelect.addEventListener("change", createBoard);
      themeSelect.addEventListener("change", createBoard);
      restartBtn.addEventListener("click", createBoard);

      createBoard();

      // Confetti
      let confettiParticles = [],
        confettiAnimation;
      function startConfetti() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
        confettiParticles = [];
        for (let i = 0; i < 150; i++) {
          confettiParticles.push({
            x: Math.random() * confettiCanvas.width,
            y: Math.random() * confettiCanvas.height - confettiCanvas.height,
            r: Math.random() * 6 + 4,
            d: Math.random() * 150,
            color: `hsl(${Math.random() * 360},100%,50%)`,
            tilt: Math.random() * 10 - 10,
          });
        }
        animateConfetti();
      }
      function animateConfetti() {
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        confettiParticles.forEach((p) => {
          ctx.beginPath();
          ctx.moveTo(p.x + p.tilt + p.r / 2, p.y);
          ctx.lineTo(p.x + p.tilt, p.y + p.r);
          ctx.strokeStyle = p.color;
          ctx.lineWidth = p.r / 2;
          ctx.stroke();
          p.y += Math.cos(0.01 + p.d) * 2 + 1 + p.r / 2;
          p.x += Math.sin(0.01);
          if (p.y > confettiCanvas.height) {
            p.y = 0;
            p.x = Math.random() * confettiCanvas.width;
          }
        });
        confettiAnimation = requestAnimationFrame(animateConfetti);
      }
      function stopConfetti() {
        cancelAnimationFrame(confettiAnimation);
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      }
    </script>
  </body>
</html>
